<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Irrigation Planner - SmartAgri</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='irr.css') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>
<body>
    <header class="neumorphic-header">
        <a href="{{ url_for('index') }}" class="back-btn neumorphic neumorphic-button">‚Üê Back</a>
        <h1>SmartAgri üåæ</h1>
    </header>

    <div class="container">
        <h2 class="mt-3">üíß Smart Irrigation Planner</h2>
        <p class="text-muted mb-4">Plan your irrigation for optimal crop growth.</p>

        <div class="row g-3">
            <div class="col-12">
                <label for="cropType" class="form-label">Crop Type:</label>
                <input type="text" id="cropType" class="form-control neumorphic" placeholder="e.g., Wheat" required>
            </div>
            <div class="col-12">
                <label for="location" class="form-label">Location:</label>
                <input type="text" id="location" class="form-control neumorphic" placeholder="e.g., Bangalore" required>
            </div>
            <div class="col-12">
                <label for="plantingDate" class="form-label">Planting Date (optional):</label>
                <input type="date" id="plantingDate" class="form-control neumorphic">
            </div>
            <div class="col-12">
                <label for="growthStage" class="form-label">Growth Stage (optional):</label>
                <input type="text" id="growthStage" class="form-control neumorphic" placeholder="e.g., Vegetative">
            </div>
            <div class="col-12">
                <button class="btn neumorphic-button w-100" onclick="planIrrigation()">Get Irrigation Plan</button>
            </div>

            <div id="result-container" class="col-12 hidden">
                <h3 class="mt-3">üíß Irrigation Plan</h3>
                <div id="result" class="result-box"></div>
            </div>
        </div>
    </div>

    <footer class="neumorphic-footer">
        <p>¬© 2025 SmartAgri. All rights reserved.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function planIrrigation() {
            const cropType = document.getElementById('cropType').value;
            const location = document.getElementById('location').value;
            let plantingDate = document.getElementById('plantingDate').value;
            const growthStage = document.getElementById('growthStage').value;

            if (!cropType || !location) {
                alert("Please provide crop type and location.");
                return;
            }

            if (plantingDate) {
                const [year, month, day] = plantingDate.split('-');
                plantingDate = `${day}-${month}-${year}`;  // Convert to DD-MM-YYYY
            }

            const data = {
                crop_type: cropType,
                location: location,
                planting_date: plantingDate || "Not provided",
                growth_stage: growthStage || "Not provided"
            };

            fetch('/irrigation_plan', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                    return;
                }

                const resultContainer = document.getElementById('result-container');
                const resultBox = document.getElementById('result');
                resultBox.innerHTML = `
                    <p><strong>Crop Type:</strong> ${data.data.crop_type}</p>
                    <p><strong>Location:</strong> ${data.data.location}</p>
                    <p><strong>Temperature:</strong> ${data.data.temperature}C</p>
                    <p><strong>Humidity:</strong> ${data.data.humidity}%</p>
                    <p><strong>Weather Conditions:</strong> ${data.data.weather_conditions}</p>
                    <p><strong>Irrigation Frequency:</strong> ${data.data.irrigation_frequency}</p>
                    <p><strong>Water Amount:</strong> ${data.data.water_amount}</p>
                    <p><strong>Reason:</strong> ${data.data.reason}</p>
                `;
                resultContainer.classList.remove('hidden');
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error generating irrigation plan. Please try again.');
            });
        }
    </script>
</body>
</html>